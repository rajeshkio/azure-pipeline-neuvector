pool: Default

steps:
 - script: echo Hello, world!
   displayName: "print hello world"

 - script: docker build -t rk90229/hello-world:$(Build.BuildNumber) -f Dockerfile_Hello_World_Image . 
   displayName: "Build image from dockerfile"

 - task: NeuVectorScan@3
   displayName: Scan image with NeuVector
   inputs:
     scanType: 'standalone'
     nvContainerRegistry: 'docker-test'
     nvRepository: 'neuvector/scanner'
     nvTag: 'latest'
     containerRegistry: 'docker-test'
     repository: rk90229/hello-world:$(Build.BuildNumber)
     tag: 'latest'
     failOnHighSeverityThreshold: false
     highSeverityThreshold: '2'
     failOnMediumSeverityThreshold: false
     mediumSeverityThreshold: '4'

 - script: docker push rk90229/hello-world:$(Build.BuildNumber)
   displayName: "Push image to dockerhub"

 - task: PublishPipelineArtifact@1
   inputs:
     targetPath: 'scan_result.json'
     artifactType: 'pipeline'
     artifactName: 'scan_results'
